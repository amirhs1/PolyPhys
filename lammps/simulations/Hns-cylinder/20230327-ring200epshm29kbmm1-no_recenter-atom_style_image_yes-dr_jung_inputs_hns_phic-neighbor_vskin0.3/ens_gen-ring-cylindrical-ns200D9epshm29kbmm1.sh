#!/bin/bash
# kbend is in LAMMPS lingo which is half the regualr one, so kbend_mm=2 in LAMMPS means kbend_mm=4 in theory.
#            N      epsilon_hns_mon kbend   n_hns   a_crowd n_crowd     r
#            lz   rseed_group run_dt  ndump   adump   
P[${#P[@]}]="200	29				1		0		1		0		4.5	45	50000		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		19099	4.5	45	50010		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		28648	4.5	45	50020		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		38198	4.5	45	50030		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		47747	4.5	45	50040		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		57296	4.5	45	50050		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		66846	4.5	45	50060		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		76395	4.5	45	50070		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		90719	4.5	45	50080		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		0		1		95493	4.5	45	50090		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		0		4.5	45	51000		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		19099	4.5	45	51010		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		28648	4.5	45	51020		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		38198	4.5	45	51030		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		47747	4.5	45	51040		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		57296	4.5	45	51050		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		66846	4.5	45	51060		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		76395	4.5	45	51070		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		90719	4.5	45	51080		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		4		1		95493	4.5	45	51090		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		0		4.5	45	52000		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		19099	4.5	45	52010		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		28648	4.5	45	52020		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		38198	4.5	45	52030		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		47747	4.5	45	52040		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		57296	4.5	45	52050		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		66846	4.5	45	52060		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		76395	4.5	45	52070		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		90719	4.5	45	52080		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		8		1		95493	4.5	45	52090		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		0		4.5	45	53000		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		19099	4.5	45	53010		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		28648	4.5	45	53020		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		38198	4.5	45	53030		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		47747	4.5	45	53040		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		57296	4.5	45	53050		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		66846	4.5	45	53060		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		76395	4.5	45	53070		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		90719	4.5	45	53080		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		12		1		95493	4.5	45	53090		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		0		4.5	45	54000		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		19099	4.5	45	54010		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		28648	4.5	45	54020		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		38198	4.5	45	54030		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		47747	4.5	45	54040		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		57296	4.5	45	54050		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		66846	4.5	45	54060		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		76395	4.5	45	54070		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		90719	4.5	45	54080		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		16		1		95493	4.5	45	54090		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		0		4.5	45	55000		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		19099	4.5	45	55010		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		28648	4.5	45	55020		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		38198	4.5	45	55030		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		47747	4.5	45	55040		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		57296	4.5	45	55050		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		66846	4.5	45	55060		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		76395	4.5	45	55070		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		90719	4.5	45	55080		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		20		1		95493	4.5	45	55090		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		0		4.5	45	56000		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		19099	4.5	45	56010		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		28648	4.5	45	56020		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		38198	4.5	45	56030		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		47747	4.5	45	56040		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		57296	4.5	45	56050		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		66846	4.5	45	56060		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		76395	4.5	45	56070		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		90719	4.5	45	56080		0.005	2000 	5000 	5"
P[${#P[@]}]="200	29				1		30		1		95493	4.5	45	56090		0.005	2000 	5000 	5"


#ens='1 2 3 4 5 6 7 8' # Here, we define a global variable called "ens" which is the total ensemble we use in our simulation.
ens='1 2' # Here, we define a global variable called "ens" which is the total ensemble we use in our simulation.

for i in ${ens}; do # ${NAME} uses the value saved in variable called NAME; it is like the LAMMPS itself.
	for ((j=0; j<${#P[@]}; j++ )); do
		N=$(echo "${P[$j]}" | awk '{print $1}') # number of monomers
		eps_hm=$(echo "${P[$j]}" | awk '{print $2}')
		kBend=$(echo "${P[$j]}" | awk '{print $3}')
		n_hns=$(echo "${P[$j]}" | awk '{print $4}')
		sig4=$(echo "${P[$j]}" | awk '{print $5}') # sizeo of crowders
		n_crowd=$(echo "${P[$j]}" | awk '{print $6}')
		r=$(echo "${P[$j]}" | awk '{print $7}')
		lz=$(echo "${P[$j]}" | awk '{print $8}') # range of x, y or z from -l to l
		randseed_group=$(echo "${P[$j]}" | awk '{print $9}')
		run_dt=$(echo "${P[$j]}" | awk '{print $10}') # integration time delta 
		nucleoid_dump=$(echo "${P[$j]}" | awk '{print $11}')
		all_dump=$(echo "${P[$j]}" | awk '{print $12}')
		eps_wall=$(echo "${P[$j]}" | awk '{print $13}')
		dirname=N${N}dt${run_dt}ndump${nucleoid_dump}adump${all_dump}kbmm${kBend}r${r}lz${lz}nh${n_hns}ac${sig4}nc${n_crowd}ens${i}.ring
		simname=N${N}dt${run_dt}ndump${nucleoid_dump}adump${all_dump}kbmm${kBend}r${r}lz${lz}nh${n_hns}ac${sig4}nc${n_crowd}ens${i}
		# minimization and equilibration script
		cp hns-cylindrical-minimize_dna.lmp input.lmp
		echo "variable randseed equal $((i+randseed_group))" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable i equal $i" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable r equal $r" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable lz equal ${lz}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable kBend11 equal ${kBend}" | cat - input.lmp > temp && mv temp input.lmp
		echo '# Defining input parameters:' | cat - input.lmp > temp && mv temp input.lmp
		mv input.lmp minimize_dna.lmp
		[[ -d "${dirname}" ]] || mkdir "${dirname}"
		mv minimize_dna.lmp "${dirname}/"
		cp submit_minimize_dna.sh "${dirname}/" 
		# production script
		if [ $((n_crowd)) -eq 0 ];
		then
			cp hns-cylindrical_v1-ac_equal_a.lmp input.lmp
		else
			if [ $((sig4)) -ne 1 ];
			then
				cp hns-cylindrical_v1.lmp input.lmp	
			else
				cp hns-cylindrical_v1-ac_equal_a.lmp input.lmp
			fi
		fi
		echo "variable simname string ${simname}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable adump equal ${all_dump}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable ndump equal ${nucleoid_dump}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable run_dt equal ${run_dt}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable randseed equal $((i+randseed_group))" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable i equal $i" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable r equal $r" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable lz equal ${lz}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable n_crowd equal ${n_crowd}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable sig4 equal ${sig4}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable n_hns equal ${n_hns}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable kBend11 equal ${kBend}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable eps_hm equal ${eps_hm}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable N equal ${N}" | cat - input.lmp > temp && mv temp input.lmp
		echo '# Defining input parameters:' | cat - input.lmp > temp && mv temp input.lmp

		mv input.lmp "${dirname}/"
		cp dna.data "${dirname}/"
		cp hns.mol "${dirname}/"

		N_no_crowd=$((N+n_hns))
		if [ $((n_crowd+N_no_crowd)) -ne ${N_no_crowd} ];
		then
			if [ $((n_crowd+N)) -le 5000 ]; 
			then
				cp submit_cpu4_le5000.sh submit.sh && mv submit.sh "$dirname"
			elif [ $((n_crowd+N)) -gt 5000 ] && [ $((n_crowd+N)) -le 15000 ]; then
				cp submit_cpu4_gt5000_le15000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 15000 ] && [ $((n_crowd+N)) -le 30000 ]; then
				cp submit_cpu8_gt15000_le30000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 30000 ] && [ $((n_crowd+N)) -le 75000 ]; then
				cp submit_cpu16_gt30000_le75000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 75000 ] && [ $((n_crowd+N)) -le 150000 ]; then
				cp submit_cpu32_gt75000_le150000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 150000 ] && [ $((n_crowd+N)) -le 200000 ]; then
				cp submit_cpu32_gt150000_le200000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 200000 ] && [ $((n_crowd+N)) -le 250000 ]; then
				cp submit_cpu32_gt150000_le200000.sh submit.sh && mv submit.sh "${dirname}"
			else
				cp submit_cpu32_gt250000_le300000.sh submit.sh && mv submit.sh "${dirname}"
			fi
		else
			cp submit_nocrowd_20hrs.sh submit.sh && mv submit.sh "${dirname}"
		fi
		cd "${dirname}" || exit
		[[ -d restarts ]] || mkdir restarts
		cd ..
	done
done