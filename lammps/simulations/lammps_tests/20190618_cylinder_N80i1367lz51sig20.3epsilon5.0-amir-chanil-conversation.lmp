# Type: 3-d LJ polymer simulation
# Description: A computational study of the compaction of a linear polymeric chain by spherical crowders in a cylindrical confinement. 

# Amir: The end-to-end size of a single chain in a cylindrical confinement (no crowders) is given by R_F=1.37*N*a*(D/a)^(-2/3) where N=number of monomers, D=diameter of the cylinder, a=size of the monomer. 
# For D=6a, N=80, and a=1, R_F=34

#------------------------------------------
#--------------------- (1) Variables defined by command-line tools ---------------------
#------------------------------------------

#List of variables and their names defined by command line method. Their description and the step they will be used in are described in next sections:
#variable ${in_filename}
#variable ${i} # i is the seed for the RNG.

# Amir: The diameter of the cylinder is d=2*r.
 
#variable ${r} # the radius of the cylinder.

# Amir: lz=L_cylinder/2 were L_cylinder=3*R_F so
# For R_F=34, L=103 ,ad lz=51

#variable ${lz} # the length of the cylinder in the longitudinal direction z
#variable ${sig2} # diameter of a crowder

# Amir: If a_c=0.3a=0.3 (where a=1), then for \phi_c=volume fraction of crowders=0.30, and 0.40, n_crowd=61200, and 81600 respectively. 
#variable ${n_crowd} # Number of the crowders

#variable ${epsilon1} # the strength of the LJ potential of the wall built on the lateral surface of the cylinder.

#------------------------------------------
#--------------------- (2) Initialization ---------------------
#------------------------------------------

log log.lammps.${i} 
units   lj # Lennard-Jones units.
dimension   3 # 3 dimensional simulation.
boundary    f f p # Periodic (p) in z direction but non-periodic and fixed (f) in x and y directions.
atom_style  bond

#------------------------------------------
#--------------------- (3) Neighbor Lists ---------------------
#------------------------------------------

neighbor        0.2 bin 
neigh_modify    delay 0 every 1 check yes one 300 page 3000

#------------------------------------------
#--------------------- (4) Processors Communications ---------------------
#------------------------------------------


#------------------------------------------
#--------------------- (5) Atom Definition ---------------------
#------------------------------------------

#---------- Read input file ----------
read_data   ${in_filename} 

#---------- Reshape simulation box/Define simulation box   ----------
change_box  all x final -${r} ${r} y final -${r} ${r} z final -${lz} ${lz} boundary f f p units box 
region  cylshell cylinder z 0.0 0.0 ${r} INF INF units box 

#---------- Create atoms ----------
variable    randseed equal ${i}+1000 
create_atoms	2 random ${n_crowd} ${randseed} cylshell units 

#---------- Group atoms ----------
group   bug type 1 
group   crowd type 2

#---------- Define atoms masses ----------
mass 1 1.0
mass 2 1.0

#---------- Set velocity of the chain ----------
#----- Define a temperature compute for the chain and use to set velocity for the chain -----
compute mobile bug temp 
velocity   bug create 1.0 ${randseed} temp mobile 

#------------------------------------------
#--------------------- (6) Interatomic/molecular Potential ---------------------
#------------------------------------------

#---------- Lennard-Jones potential among all particles ----------
#---------- (6-a) Variables ----------
variable sig1 equal 1.0
variable sig12 equal (${sig1}+${sig2})/2
variable cutoff11 equal ${sig1}*1.12246
variable cutoff12 equal ((${sig1}+${sig2})/2.0)*1.12246
variable cutoff22 equal ${sig2}*1.12246

pair_style      lj/cut 1.12246 # Cutoff distance = 2^(1/6) = 1.12246. For each pair, this cutoff is multiplied by sig_{ij} to give the real cutoff for each pair. 
# Amir: This choice of cutoff distance with 5 meaningful digits limits the precision of our calculation. 

#Pair coefficient:   type-i  type-j (i should always be smaller than j) epsilon=1 sigma=(a_i+a_j)/2   cutoff=((sig_i+sig_j)/2)*2^(1/6) 
pair_coeff      1 1 1.0 ${sig1}  ${cutoff11}
pair_coeff      1 2 1.0 ${sig12} ${cutoff12}
pair_coeff      2 2 1.0 ${sig2}  ${cutoff22}

#---------- FENE potential among the chain's monomers ----------
#---------- (6-b) Variables ----------
variable    sig1_fene equal 1.5*${sig1} 
variable    k1_fene equal  30/(${sig1}*${sig1})

bond_style  fene

#Bond coefficient:  type-i  K=(30*epsilon)/((a_i+a_j_^2)   R_0=1.5*((a_i+a_j)/2 )   epsilon=1    sigma=(a_i+a_j)/2
bond_coeff  1 ${k1_fene}  ${sig1_fene}    1.0 ${sig1}

#---------- Weighting coefficient for bonded atoms with pairwise interactions (Example,LJ interaction of two monomers in a chain) ----------
special_bonds   fene


#------------------------------------------
#--------------------- (7) Settings ---------------------
#------------------------------------------

#---------- Equilibration/Method of integration of equation of motion ----------
# Microcanonical ensamble:
fix     F_nve all nve/limit 0.01 

#---------- Brownian dynamics for all particles ----------
fix     F_langevin all langevin 1.0 1.0 10.0 ${randseed}

#---------- Lennard-Jones potential between the lateral wall and each type of particles ----------
fix     F_wall1 bug wall/region cylshell lj126 ${epsilon1} ${sig1} ${cutoff11} # Interaction between the lateral wall and the monomers. 
fix     F_wall2 crowd wall/region cylshell lj126 1.0 ${sig12}  ${cutoff12} # Interaction between the lateral wall and the crowders.

fix     F_recenter bug recenter NULL NULL 0.0 shift all units box 


#------------------------------------------
#--------------------- (8) Run a simulation ---------------------
#------------------------------------------

#---------- Equilibration run (Dynamic phase)
timestep 0.01

thermo 10000
dump	 D_all_dynamic all custom 1000 all.dynamic.${i}.lammpstrj id type x y z xs ys zs
run 1000000   
write_restart    ./restart_before.${i}  

# Wiping out commands
unfix F_nve
unfix F_recenter 

#---------- After equilibration (Data gathering run)
#Reset some settings
fix        F_nve all nve 
fix        F_recenter bug recenter NULL NULL 0.0 shift all units box 

timestep    0.002 

dump	 D_all all custom 1000 all.${i}.lammpstrj id type x y z xs ys zs 
restart 1000000  ./restarts/restart_during.${i} 
run	50000000    
write_restart    ./restart_after.${i}