#--------------------- (2) Initialization ---------------------
units   lj # Lennard-Jones units.
dimension   3 # 3 dimensional simulation.
boundary    f f p # Periodic (p) in z direction but non-periodic and fixed (f) in x and y directions.
atom_style  bond

#--------------------- (3) Neighbor Lists ---------------------
neighbor        0.2 multi # This option inceases speed when there is a wide range of cutoff distances.
neigh_modify    delay 0 every 1 check yes
comm_modify mode multi reduce/multi # This should be set as well if neighbor is set to multi.
#--------------------- (4) Processors Communications ---------------------
processors 1 1 *
#--------------------- (5) Atom Definition ---------------------

#---------- Read input file ----------
read_data   initial_config.data

#---------- Reshape simulation box/Define simulation box   ----------
change_box  all x final -${r} ${r} y final -${r} ${r} z final -${lz} ${lz} boundary f f p units box
region  cylshell cylinder z 0.0 0.0 ${r} INF INF units box

#---------- Create atoms ----------
create_atoms	3 random ${n_crowd} ${randseed} cylshell units box

#---------- Group atoms ----------
group   bug_small type 1
group   bug_big type 2
group	bug type 1 2
group   crowd type 3

#---------- Define atoms masses ----------
mass 1 1.0
mass 2 ${mass2}
mass 3 1.0

#---------- Set velocity of the chain ----------
#----- Define a temperature compute for the chain and use to set velocity for the chain -----
compute mobile bug temp

#--------------------- (6) Interatomic/molecular Potential ---------------------
#---------- Lennard-Jones potential among all particles ----------
#---------- (6-a) Variables ----------
variable sig1 equal 1.0
variable sig2 equal ${sig2}
variable sig12 equal (${sig1}+${sig2})/2
variable sig13 equal (${sig1}+${sig3})/2
variable sig23 equal (${sig2}+${sig3})/2

variable cutoff11 equal ${sig1}*1.12246205
variable cutoff12 equal ((${sig1}+${sig2})/2.0)*1.12246205
variable cutoff22 equal ${sig2}*1.12246205
variable cutoff13 equal ((${sig1}+${sig3})/2.0)*1.12246205
variable cutoff23 equal ((${sig2}+${sig3})/2.0)*1.12246205
variable cutoff33 equal ${sig3}*1.12246205

pair_style      lj/cut 1.12246205

#Pair coefficient:   type-i  type-j (i should always be smaller than j) epsilon=1 sigma=(a_i+a_j)/2   cutoff=((sig_i+sig_j)/2)*2^(1/6)
pair_coeff      1 1 1.0 ${sig1}  ${cutoff11}
pair_coeff      1 2 1.0 ${sig12} ${cutoff12}
pair_coeff      2 2 1.0 ${sig2}  ${cutoff22}
pair_coeff      1 3 1.0 ${sig13}  ${cutoff13}
pair_coeff      2 3 1.0 ${sig23}  ${cutoff23}
pair_coeff      3 3 1.0 ${sig3}  ${cutoff33}

#---------- FENE potential among the chain's monomers ----------
#---------- (6-b) Variables ----------
variable    sig11_fene equal 1.5*${sig1}
variable    sig12_fene equal 1.5*${sig1}*(${sig12}/${sig1})
variable    k11_fene equal  30/(${sig1}*${sig1})
variable    k12_fene equal  (30/(${sig1}*${sig1}))*((${sig1}/${sig12})^2)

bond_style  fene

#Bond coefficient:  type-i  K=(30*epsilon)/((a_i+a_j_^2)   R_0=1.5*((a_i+a_j)/2 )   epsilon=1    sigma=(a_i+a_j)/2
bond_coeff  1 ${k11_fene}  ${sig11_fene}    1.0 ${sig1}
bond_coeff  2 ${k12_fene}  ${sig12_fene}    1.0 ${sig12}

#---------- Weighting coefficient for bonded atoms with pairwise interactions (Example,LJ interaction of two monomers in a chain) ----------
special_bonds   fene

#--------------------- (7) Settings ---------------------
#---------- Equilibration/Method of integration of equation of motion ----------
# Microcanonical ensamble:
fix     F_nve all nve/limit 0.01

#---------- Brownian dynamics for all particles ----------
fix     F_langevin all langevin 1.0 1.0 10.0 ${randseed}

#---------- Lennard-Jones potential between the lateral wall and each type of particles ----------
fix     F_wall_small bug_small wall/region cylshell lj126 ${epsilon_small} ${sig1} ${cutoff11} # Interaction between the lateral wall and the monomers.
fix     F_wall_big bug_big wall/region cylshell lj126 ${epsilon_big} ${sig12} ${cutoff12} # Interaction between the lateral wall and the monomers.
fix     F_wall_corwd crowd wall/region cylshell lj126 1.0 ${sig13}  ${cutoff13} # Interaction between the lateral wall and the crowders.

fix     F_recenter bug recenter NULL NULL 0.0 shift all units box

#--------------------- (8) Run a simulation ---------------------
#---------- Equilibration run (Dynamic phase)
timestep 0.02
thermo 10000
thermo_style multi
run 1000000
write_restart    ./restart_before.i${i}


# Wiping out commands
unfix F_nve
unfix F_recenter

#---------- After equilibration (Data gathering run)
#Reset some settings
fix        F_nve all nve
fix        F_recenter bug recenter NULL NULL 0.0 shift all units box

timestep    ${run_dt}

dump	 D_bug bug atom  ${bug_dump} bug.i${i}.lammpstrj
dump_modify D_bug scale no

dump	 D_bug_custom bug custom  ${bug_dump} bug.velocity.i${i}.lammpstrj id type x y z vx vy vz uz
dump_modify D_bug_custom scale no

dump	 D_bug_custom_unwrapped bug custom  ${bug_dump} bug.unwrap.i${i}.lammpstrj id type x y z vx vy vz
dump_modify D_bug_custom_unwrapped scale no unwrap yes


variable fname string input.lmp
variable j loop 20 pad # Having 14 roughly 7GB-size dump files padding with 2
	label dump_loop
	
	dump	 D_all all atom ${all_dump} all.i${i}.j${j}.lammpstrj.gz
	dump_modify D_all scale no pad 2

	dump	 D_all_custom all atom ${all_dump} all.unwrap.i${i}.j${j}.lammpstrj.gz
	dump_modify D_all_custom scale no pad 2 unwrap yes

	restart 1000000  ./restarts/restart.${i}
	run	5000000
	undump D_all
	undump D_all_custom
	next j
	jump ${fname} dump_loop # input.lmp is the input script itself to prevent any issues related to stdin and SELF.
#After this loop, the systems evolves 5.1*10E7 timesteps
undump D_bug
undump D_bug_custom
undump D_bug_custom_unwrapped

write_data all.ns${n_small}.nb${n_big}.nc${n_crowd}.data pair ij
write_restart    ./restart_after.i${i}
