# Description: A computational study of the compaction of a linear chain by crowders in free space (cubic simulation box). 
# Please see this article: https://pubs.rsc.org/en/content/articlelanding/2016/sm/c6sm01924b#!divAbstract

# Amir: I used R_F=1.1 {N}^{\frac{3}{5}} to estimate the end-to-end size of the chain by theory (Flory radius), then I used 3 times this value as the size of the simulation box. For N=50, R_f=12a where a=1, and l (size od the cubic box) is 36a.
# Amir: For: L=36, diameter of crowder=a_c=sig2=0.3, and p\phi_c=volume fraction of crowders=0.15, number of crowders=n_crowd=495036. If I want to have \phi_c=0.3 then n_crowder=990072!!! Are there values for number of crowders correct. I used n_crowd=(\phi_c*V_{simulation box})/v_{crowder}. For a_c=0.2 it is even more!

#------------------------------------------
#--------------------- Variables defined by command-line tools ---------------------
#------------------------------------------

#List of variables and their names defined by command line method. Their description and the step they will be used in are described in next sections:
#variable ${in_filename}
#variable ${i} # i is the seed for random number generator. You may want to run many SAME simulations for ensemble average.
#variable ${l} # size of the simulation box
#variable ${n_crowd} # Number of crowders
#variable ${sig2} # diameter of a crowder

#--------------------- (1) Initialization ---------------------
units   lj # Lennard-Jones units.
dimension   3 # 3 dimensional simulation.
boundary    p p p # Periodic (p) in all directions 
atom_style  bond
             
#--------------------- (2) Neighbor Lists ---------------------
neighbor        0.2 bin 
neigh_modify    delay 0 every 1 check yes one 300 page 3000

#--------------------- (3) Processors Communications ---------------------

#--------------------- (4) Atom Definition ---------------------

#---------- Read input file ----------
read_data   data.chain.50 

#---------- Reshape simulation box/Define simulation box   ----------
change_box  all x final -${l} ${l} y final -${l} ${l} z final -${l} ${l} boundary p p p units box 
region  cubicshell block INF INF INF INF INF INF units box 

#---------- Create atoms ----------
variable    randseed equal ${i}+1000 
create_atoms 2 random ${n_crowd} ${randseed} cubicshell units box
#---------- Group atoms ----------
group   bug type 1 
group   crowd type 2

#---------- Define atoms masses ----------
mass 1 1.0
mass 2 1.0

#---------- Set velocity of the chain ----------
#----- Define a temperature compute for the chain -----
compute mobile bug temp 

#----- Set velocity for the chain -----
velocity   bug create 1.0 ${randseed} temp mobile 

#--------------------- (5) Interatomic/molecular Potential ---------------------
#---------- Lennard-Jones potential among all particles ----------
#---------- (6-a) Variables ----------
variable sig1 equal 1.0
variable sig12 equal (${sig1}+${sig2})/2
# Amir: Below, we stimated 2^(1/6); is not it a source of error? is not better to use a more accurate estimation?
variable cutoff11 equal ${sig1}*1.12246
variable cutoff12 equal ((${sig1}+${sig2})/2.0)*1.12246
variable cutoff22 equal ${sig2}*1.12246

pair_style      lj/cut 1.12246 
#Pair coefficient:   type-i  type-j (i should always be smaller than j) epsilon=1 sigma=(a_i+a_j)/2   cutoff=((sig_i+sig_j)/2)*2^(1/6) 
pair_coeff      1 1 1.0 ${sig1}  ${cutoff11}ยง
pair_coeff      1 2 1.0 ${sig12} ${cutoff12}
pair_coeff      2 2 1.0 ${sig2}  ${cutoff22}

#---------- FENE potential among the chain's monomers ----------
# The FENE potential only exist among the monomers consisitng the chain
# Amir: Does the FENE potential only exist among the monomers?  
variable    sig1_fene equal 1.5*${sig1}
variable    k1_fene equal  30/(${sig1}*${sig1})

bond_style  fene

#Bond coefficient:  type-i  K=(30*epsilon)/((a_i+a_j_^2)   R_0=1.5*((a_i+a_j)/2 )   epsilon=1    sigma=(a_i+a_j)/2
bond_coeff  1 ${k1_fene}  ${sig1_fene}    1.0 ${sig1}

#---------- Weighting coefficient for bonded atoms with pairwise interactions (Example,LJ interaction of two monomers in a chain) ----------
special_bonds   fene

#--------------------- (6) Settings ---------------------
#---------- Equilibration/Method of integration of equation of motion ----------
#Microcanonical ensamble:
fix     F_nve all nve/limit 0.01 
#Brownian dynamics for all particles 
fix     F_langevin all langevin 1.0 1.0 10.0 ${randseed}

# Amir: IS the following command needed in free space? or it is only needed for the cylindrical coordinate system to keep the chian at z=0
fix     F_recenter bug recenter NULL NULL 0.0 shift all units box 

#--------------------- (7) Run a simulation ---------------------

#---------- Equilibration run ----------
timestep 0.01 
thermo 1000 
# I want to have some snapshots before the equilibrium.
# Besided the real  coordiante, the scaled coordinates  are also dumped to the output file
dump	D_all_dynamic all custom 1000 all.dynamic.${i}.lammpstrj id type x y z xs ys zs

run	10000 
write_restart    restart_after_equi.${i}  
#Wiping out commands
unfix F_nve
unfix F_recenter 

#---------- After euilibration (Data gathering run)
fix        F_nve all nve 
# Amir: Thw same as above
fix        F_recenter bug recenter NULL NULL 0.0 shift all units box 

timestep    0.002 
dump	D_all all custom 1000 all.${i}.lammpstrj id type x y z xs ys zs 
restart	10000  archive/restart.${i} 
run	50000
