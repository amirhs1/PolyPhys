#!/bin/bash
# kbend is in LAMMPS lingo which is half the regualr one, so kbend_mm=2 in LAMMPS means kbend_mm=4 in theory.
#            N		kbend   n_hns   a_crowd n_crowd     eps_hc	l	rseed_group 
P[${#P[@]}]="200 	2		0		2		0			0		25	1000"
P[${#P[@]}]="200 	2		0		2		2387		0		25	1010"
P[${#P[@]}]="200 	2		0		2		3581		0		25	1020"
P[${#P[@]}]="200 	2		0		2		4775		0		25	1030"
P[${#P[@]}]="200 	2		0		2		5968		0		25	1040"
P[${#P[@]}]="200 	2		0		2		7162		0		25	1050"
P[${#P[@]}]="200 	2		0		2		8356		0		25	1060"
P[${#P[@]}]="200 	2		0		2		9549		0		25	1070"
P[${#P[@]}]="200 	2		0		2		10743		0		25	1080"
P[${#P[@]}]="200 	2		0		2		11937		0		25	1090"
P[${#P[@]}]="200 	2		4		2		0			0		25	3000"
P[${#P[@]}]="200 	2		4		2		2387		0		25	3010"
P[${#P[@]}]="200 	2		4		2		3581		0		25	3020"
P[${#P[@]}]="200 	2		4		2		4775		0		25	3030"
P[${#P[@]}]="200 	2		4		2		5968		0		25	3040"
P[${#P[@]}]="200 	2		4		2		7162		0		25	3050"
P[${#P[@]}]="200 	2		4		2		8356		0		25	3060"
P[${#P[@]}]="200 	2		4		2		9549		0		25	3070"
P[${#P[@]}]="200 	2		4		2		10743		0		25	3080"
P[${#P[@]}]="200 	2		4		2		11937		0		25	3090"
P[${#P[@]}]="200 	2		8		2		0			0		25	5000"
P[${#P[@]}]="200 	2		8		2		2387		0		25	5010"
P[${#P[@]}]="200 	2		8		2		3581		0		25	5020"
P[${#P[@]}]="200 	2		8		2		4775		0		25	5030"
P[${#P[@]}]="200 	2		8		2		5968		0		25	5040"
P[${#P[@]}]="200 	2		8		2		7162		0		25	5050"
P[${#P[@]}]="200 	2		8		2		8356		0		25	5060"
P[${#P[@]}]="200 	2		8		2		9549		0		25	5070"
P[${#P[@]}]="200 	2		8		2		10743		0		25  5080"
P[${#P[@]}]="200 	2		8		2		11937		0		25	5090"
P[${#P[@]}]="200 	2		12		2		0			0		25	7000"
P[${#P[@]}]="200 	2		12		2		2387		0		25	7010"
P[${#P[@]}]="200 	2		12		2		3581		0		25	7020"
P[${#P[@]}]="200 	2		12		2		4775		0		25	7030"
P[${#P[@]}]="200 	2		12		2		5968		0		25	7040"
P[${#P[@]}]="200 	2		12		2		7162		0		25	7050"
P[${#P[@]}]="200 	2		12		2		8356		0		25	7060"
P[${#P[@]}]="200 	2		12		2		9549		0		25	7070"
P[${#P[@]}]="200 	2		12		2		10743		0		25	7080"
P[${#P[@]}]="200 	2		12		2		11937		0		25	7090"
P[${#P[@]}]="200 	2		16		2		0			0		25	9000"
P[${#P[@]}]="200 	2		16		2		2387		0		25	9010"
P[${#P[@]}]="200 	2		16		2		3581		0		25	9020"
P[${#P[@]}]="200 	2		16		2		4775		0		25	9030"
P[${#P[@]}]="200 	2		16		2		5968		0		25	9040"
P[${#P[@]}]="200 	2		16		2		7162		0		25	9050"
P[${#P[@]}]="200 	2		16		2		8356		0		25	9060"
P[${#P[@]}]="200 	2		16		2		9549		0		25	9070"
P[${#P[@]}]="200 	2		16		2		10743		0		25  9080"
P[${#P[@]}]="200 	2		16		2		11937		0		25	9090"
P[${#P[@]}]="200 	2		20		2		0			0		25	11000"
P[${#P[@]}]="200 	2		20		2		2387		0		25	11010"
P[${#P[@]}]="200 	2		20		2		3581		0		25	11020"
P[${#P[@]}]="200 	2		20		2		4775		0		25	11030"
P[${#P[@]}]="200 	2		20		2		5968		0		25	11040"
P[${#P[@]}]="200 	2		20		2		7162		0		25	11050"
P[${#P[@]}]="200 	2		20		2		8356		0		25	11060"
P[${#P[@]}]="200 	2		20		2		9549		0		25	11070"
P[${#P[@]}]="200 	2		20		2		10743		0		25	11080"
P[${#P[@]}]="200 	2		20		2		11937		0		25	11090"
P[${#P[@]}]="200 	2		30		2		0			0		25	13000"
P[${#P[@]}]="200 	2		30		2		2387		0		25	13010"
P[${#P[@]}]="200 	2		30		2		3581		0		25	13020"
P[${#P[@]}]="200 	2		30		2		4775		0		25	13030"
P[${#P[@]}]="200 	2		30		2		5968		0		25	13040"
P[${#P[@]}]="200 	2		30		2		7162		0		25	13050"
P[${#P[@]}]="200 	2		30		2		8356		0		25	13060"
P[${#P[@]}]="200 	2		30		2		9549		0		25	13070"
P[${#P[@]}]="200 	2		30		2		10743		0		25	13080"
P[${#P[@]}]="200 	2		30		2		11937		0		25	13090"
P[${#P[@]}]="200 	2		0		2		0			1		25	2000"
P[${#P[@]}]="200 	2		0		2		2387		1		25	2010"
P[${#P[@]}]="200 	2		0		2		3581		1		25	2020"
P[${#P[@]}]="200 	2		0		2		4775		1		25	2030"
P[${#P[@]}]="200 	2		0		2		5968		1		25	2040"
P[${#P[@]}]="200 	2		0		2		7162		1		25	2050"
P[${#P[@]}]="200 	2		0		2		8356		1		25	2060"
P[${#P[@]}]="200 	2		0		2		9549		1		25	2070"
P[${#P[@]}]="200 	2		0		2		10743		1		25  2080"
P[${#P[@]}]="200 	2		0		2		11937		1		25	2090"
P[${#P[@]}]="200 	2		4		2		0			1		25	4000"
P[${#P[@]}]="200 	2		4		2		2387		1		25	4010"
P[${#P[@]}]="200 	2		4		2		3581		1		25	4020"
P[${#P[@]}]="200 	2		4		2		4775		1		25	4030"
P[${#P[@]}]="200 	2		4		2		5968		1		25	4040"
P[${#P[@]}]="200 	2		4		2		7162		1		25	4050"
P[${#P[@]}]="200 	2		4		2		8356		1		25	4060"
P[${#P[@]}]="200 	2		4		2		9549		1		25	4070"
P[${#P[@]}]="200 	2		4		2		10743		1		25	4080"
P[${#P[@]}]="200 	2		4		2		11937		1		25	4090"
P[${#P[@]}]="200 	2		8		2		0			1		25	6000"
P[${#P[@]}]="200 	2		8		2		2387		1		25	6010"
P[${#P[@]}]="200 	2		8		2		3581		1		25	6020"
P[${#P[@]}]="200 	2		8		2		4775		1		25	6030"
P[${#P[@]}]="200 	2		8		2		5968		1		25	6040"
P[${#P[@]}]="200 	2		8		2		7162		1		25	6050"
P[${#P[@]}]="200 	2		8		2		8356		1		25	6060"
P[${#P[@]}]="200 	2		8		2		9549		1		25	6070"
P[${#P[@]}]="200 	2		8		2		10743		1		25  6080"
P[${#P[@]}]="200 	2		8		2		11937		1		25	6090"
P[${#P[@]}]="200 	2		12		2		0			1		25	8000"
P[${#P[@]}]="200 	2		12		2		2387		1		25	8010"
P[${#P[@]}]="200 	2		12		2		3581		1		25	8020"
P[${#P[@]}]="200 	2		12		2		4775		1		25	8030"
P[${#P[@]}]="200 	2		12		2		5968		1		25	8040"
P[${#P[@]}]="200 	2		12		2		7162		1		25	8050"
P[${#P[@]}]="200 	2		12		2		8356		1		25	8060"
P[${#P[@]}]="200 	2		12		2		9549		1		25	8070"
P[${#P[@]}]="200 	2		12		2		10743		1		25	8080"
P[${#P[@]}]="200 	2		12		2		11937		1		25	8090"
P[${#P[@]}]="200 	2		16		2		0			1		25	10000"
P[${#P[@]}]="200 	2		16		2		2387		1		25	10010"
P[${#P[@]}]="200 	2		16		2		3581		1		25	10020"
P[${#P[@]}]="200 	2		16		2		4775		1		25	10030"
P[${#P[@]}]="200 	2		16		2		5968		1		25	10040"
P[${#P[@]}]="200 	2		16		2		7162		1		25	10050"
P[${#P[@]}]="200 	2		16		2		8356		1		25	10060"
P[${#P[@]}]="200 	2		16		2		9549		1		25	10070"
P[${#P[@]}]="200 	2		16		2		10743		1		25  10080"
P[${#P[@]}]="200 	2		16		2		11937		1		25	10090"
P[${#P[@]}]="200 	2		20		2		0			1		25	12000"
P[${#P[@]}]="200 	2		20		2		2387		1		25	12010"
P[${#P[@]}]="200 	2		20		2		3581		1		25	12020"
P[${#P[@]}]="200 	2		20		2		4775		1		25	12030"
P[${#P[@]}]="200 	2		20		2		5968		1		25	12040"
P[${#P[@]}]="200 	2		20		2		7162		1		25	12050"
P[${#P[@]}]="200 	2		20		2		8356		1		25	12060"
P[${#P[@]}]="200 	2		20		2		9549		1		25	12070"
P[${#P[@]}]="200 	2		20		2		10743		1		25	12080"
P[${#P[@]}]="200 	2		20		2		11937		1		25	12090"
P[${#P[@]}]="200 	2		30		2		0			1		25	14000"
P[${#P[@]}]="200 	2		30		2		2387		1		25	14010"
P[${#P[@]}]="200 	2		30		2		3581		1		25	14020"
P[${#P[@]}]="200 	2		30		2		4775		1		25	14030"
P[${#P[@]}]="200 	2		30		2		5968		1		25	14040"
P[${#P[@]}]="200 	2		30		2		7162		1		25	14050"
P[${#P[@]}]="200 	2		30		2		8356		1		25	14060"
P[${#P[@]}]="200 	2		30		2		9549		1		25	14070"
P[${#P[@]}]="200 	2		30		2		10743		1		25	14080"
P[${#P[@]}]="200 	2		30		2		11937		1		25	14090"

ens='2 3 4' # Here, we define a global variable called "ens" which is the total ensemble we use in our simulation.

for i in ${ens}; do # ${NAME} uses the value saved in variable called NAME; it is like the LAMMPS itself.
	for ((j=0; j<${#P[@]}; j++ )); do
		N=$(echo "${P[$j]}" | awk '{print $1}') # number of monomers
		kBend=$(echo "${P[$j]}" | awk '{print $2}')
		n_hns=$(echo "${P[$j]}" | awk '{print $3}')
		sig4=$(echo "${P[$j]}" | awk '{print $4}') # size of crowders
		n_crowd=$(echo "${P[$j]}" | awk '{print $5}')
		eps_hc=$(echo "${P[$j]}" | awk '{print $6}')
		l=$(echo "${P[$j]}" | awk '{print $7}') # range of x, y or z from -l to l
		randseed_group=$(echo "${P[$j]}" | awk '{print $8}')
		dirname=N${N}kbmm${kBend}nh${n_hns}ac${sig4}l${l}epshc${eps_hc}nc${n_crowd}ens${i}.ring
		simname=N${N}kbmm${kBend}nh${n_hns}ac${sig4}l${l}epshc${eps_hc}nc${n_crowd}ens${i}
		# minimization and equilibration script
		cp hns-cubic-minimize_dna.lmp input.lmp
		echo "variable randseed equal $((i+randseed_group))" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable i equal $i" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable l equal ${l}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable kBend11 equal ${kBend}" | cat - input.lmp > temp && mv temp input.lmp
		echo '# Defining input parameters:' | cat - input.lmp > temp && mv temp input.lmp
		mv input.lmp minimize_dna.lmp
		[[ -d "${dirname}" ]] || mkdir "${dirname}"
		mv minimize_dna.lmp "${dirname}/"
		cp submit_minimize_dna.sh "${dirname}/" 
		# production script
		if [ $((n_crowd)) -eq 0 ];
		then
			cp hns-cubic_v9-ac_equal_a.lmp input.lmp
		else
			if [ $((sig4)) -ne 1 ];
			then
				cp hns-cubic_v9.lmp input.lmp	
			else
				cp hns-cubic_v9-ac_equal_a.lmp input.lmp
			fi
		fi
		echo "variable simname string ${simname}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable randseed equal $((i+randseed_group))" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable i equal $i" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable l equal ${l}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable n_crowd equal ${n_crowd}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable eps34 equal ${eps_hc}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable sig4 equal ${sig4}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable n_hns equal ${n_hns}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable kBend11 equal ${kBend}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable N equal ${N}" | cat - input.lmp > temp && mv temp input.lmp
		echo '# Defining input parameters:' | cat - input.lmp > temp && mv temp input.lmp

		mv input.lmp "${dirname}/"
		cp dna.data "${dirname}/"
		cp hns.mol "${dirname}/"

		N_no_crowd=$((N+n_hns))
		if [ $((n_crowd+N_no_crowd)) -ne ${N_no_crowd} ];
		then
			if [ $((n_crowd+N)) -le 5000 ]; 
			then
				cp submit_cpu4_le5000.sh submit.sh && mv submit.sh "$dirname"
			elif [ $((n_crowd+N)) -gt 5000 ] && [ $((n_crowd+N)) -le 15000 ]; then
				cp submit_cpu4_gt5000_le15000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 15000 ] && [ $((n_crowd+N)) -le 30000 ]; then
				cp submit_cpu8_gt15000_le30000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 30000 ] && [ $((n_crowd+N)) -le 75000 ]; then
				cp submit_cpu16_gt30000_le75000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 75000 ] && [ $((n_crowd+N)) -le 150000 ]; then
				cp submit_cpu32_gt75000_le150000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 150000 ] && [ $((n_crowd+N)) -le 200000 ]; then
				cp submit_cpu32_gt150000_le200000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 200000 ] && [ $((n_crowd+N)) -le 250000 ]; then
				cp submit_cpu32_gt150000_le200000.sh submit.sh && mv submit.sh "${dirname}"
			else
				cp submit_cpu32_gt250000_le300000.sh submit.sh && mv submit.sh "${dirname}"
			fi
		else
			cp submit_nocrowd_20hrs.sh submit.sh && mv submit.sh "${dirname}"
		fi
		cd "${dirname}" || exit
		[[ -d restarts ]] || mkdir restarts
		cd ..
	done
done