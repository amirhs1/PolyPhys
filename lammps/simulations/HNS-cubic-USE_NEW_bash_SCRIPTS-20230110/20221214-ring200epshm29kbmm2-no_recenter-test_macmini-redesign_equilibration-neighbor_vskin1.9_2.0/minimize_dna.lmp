# Defining input parameters:
variable N equal 200
variable kBend11 equal 20
variable n_crowd equal 1000
variable l equal 60
variable i equal 1
variable randseed equal 12001
## Defining mode variables
### sigma_ij
# 1: DNA, 2: Protein pole, 2: Protine core, 4: Crowder
# In this model, sig2 is set based on cutoff22 from cutoff2
variable ljRcut equal 1.122461 # lj/cutoff distance: 2^(1/6)
variable sig1 equal 1.0 # DNA monomers
variable sig11 equal 0.5*(${sig1}+${sig1})

### r_cutoff_ij
variable cutoff11 equal ${sig11}*${ljRcut}

### LJ epsilon_ij
# 1: DNA, 2: Protein pole, 2: Protine core, 4: Crowder
variable epsilon11 equal 1.0

### FENE: rBondFene_ij
# FENE inter-species max bond and spring constant:
# r_bond_ij = rBondFeneij 
# k_ij = kFeneij
# Lengths measured in unit sigma=sig11=sig1=1.0
# Energies measured in unit epsilon=epsilon11=1.0
# k_ij=k_11*(sig_11/sig_ij)^2
# k_11=k_0=30*epsilon_11
# r_bond_ij=r_bond_11*(sig_ij/sig_11)
# r_bond_11=r_bond_0=1.5*sig_11

#### dna-dna: FENE bond potential
variable rBondFene11 equal 1.5*${sig11}
variable kFene11 equal 30*${epsilon11}/(${sig11}^2)

## Initialization
units   lj
dimension   3
boundary    p p p
atom_style  angle

### Processors Communications
#processors 1 1 * # should be before read_data or create_box or change_box

### Read input file
# The data file should contains all the information about the atom types, 
# bond types, angles types, and the like; otherwise, you can use molecule
# command to read in new molecules, or use create_atoms to add new atoms or
# molecules to the system.
read_data dna.data nocoeff #extra/atom/types 3 extra/bond/types 1 &
		  #extra/angle/types 1

### Neighbor Lists ---------------------
# Verlet list, linked-cell binsize, and communication ghost cutoff: vskin and gskin
variable vskin equal 1.9 # v stands for Verlet
neighbor ${vskin} bin #multi # using different ghost cutoffs  
neigh_modify    delay 0 every 1 check yes

### Simulation box and regions
change_box  all x final -${l} ${l} y final -${l} ${l} z final -${l} ${l} &
            boundary p p p units box 
region cube block INF INF INF INF INF INF units box 

## Equilibration phase
### Defining and equilibrating DNA/polymer chain only
#### Atomic properties
mass 1 1.0
group dna type 1

#### Force fields
##### Lennard-Jones potential among all particles
pair_style lj/cut ${ljRcut}
pair_modify shift yes 
# Mixing rule between different species; similar to pair_modify mix arithmetic 
# LJ pair coeffs (i<=j): i j epsilon_ij sigma_ij cutoff_ij
pair_coeff 1 1 ${epsilon11} ${sig11} ${cutoff11}

##### Bond potentials
bond_style hybrid fene harmonic
special_bonds fene
# FENE bond coeffs:m (bond type) k_ij r_bond_ij epsilon_ij sigma_ij
bond_coeff 1 fene ${kFene11} ${rBondFene11} ${epsilon11} ${sig11} # dna-dna

##### Angle potentials
angle_style harmonic
# Harmonic angle coeffs:m (angle type) k_ij angle_ij
angle_coeff 1 ${kBend11} 180.0 # dna-dna-dna

#### Energy minimzation and time integration
fix F_langevin all langevin 1 1 1 ${randseed} tally yes
fix F_nve all nve/limit 0.01
fix F_recenter dna recenter 0.0 0.0 0.0 shift all units box
thermo 10000
thermo_style custom step ke pe ebond eangle edihed eimp emol evdwl ecoul &
             elong etail ecouple temp press vol
timestep 0.01
run 100000

unfix F_langevin
unfix F_nve
unfix F_recenter

fix F_langevin all langevin 1 1 1 ${randseed} tally yes
fix F_nve all nve
fix F_recenter dna recenter 0.0 0.0 0.0 shift all units box
timestep 0.005
run 1000000
write_restart ./restart.before.i${i}.part1.dna
write_data minimized.dna.data pair ij
unfix F_langevin
unfix F_nve
unfix F_recenter