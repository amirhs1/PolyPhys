#!/bin/bash
# kbend is in LAMMPS lingo which is half the regualr one, so kbend_mm=2 in LAMMPS means kbend_mm=4 in theory.
#            N		kbend   n_hns   a_crowd n_crowd	r	lz	rseed_group   
P[${#P[@]}]="200	2		0		2		0		4.5	75	70000"
P[${#P[@]}]="200	2		0		2		111		4.5	75	70010"
P[${#P[@]}]="200	2		0		2		166		4.5	75	70020"
P[${#P[@]}]="200	2		0		2		221		4.5	75	70030"
P[${#P[@]}]="200	2		0		2		276		4.5	75	70040"
P[${#P[@]}]="200	2		0		2		331		4.5	75	70050"
P[${#P[@]}]="200	2		0		2		386		4.5	75	70060"
P[${#P[@]}]="200	2		0		2		441		4.5	75	70070"
P[${#P[@]}]="200	2		0		2		497		4.5	75	70080"
P[${#P[@]}]="200	2		0		2		552		4.5	75	70090"
P[${#P[@]}]="200	2		0		2		648		4.5	75	70190"
P[${#P[@]}]="200	2		0		2		720		4.5	75	70200"
P[${#P[@]}]="200	2		0		1		1152	4.5	75	70100"
P[${#P[@]}]="200	2		0		1		1728	4.5	75	70110"
P[${#P[@]}]="200	2		0		1		2304	4.5	75	70120"
P[${#P[@]}]="200	2		0		1		2880	4.5	75	70130"
P[${#P[@]}]="200	2		0		1		3456	4.5	75	70140"
P[${#P[@]}]="200	2		0		1		4032	4.5	75	70150"
P[${#P[@]}]="200	2		0		1		4608	4.5	75	70160"
P[${#P[@]}]="200	2		0		1		5184	4.5	75	70170"
P[${#P[@]}]="200	2		0		1		5760	4.5	75	70180"
P[${#P[@]}]="200	2		4		2		0		4.5	75	71000"
P[${#P[@]}]="200	2		4		2		111		4.5	75	71010"
P[${#P[@]}]="200	2		4		2		166		4.5	75	71020"
P[${#P[@]}]="200	2		4		2		221		4.5	75	71030"
P[${#P[@]}]="200	2		4		2		276		4.5	75	71040"
P[${#P[@]}]="200	2		4		2		331		4.5	75	71050"
P[${#P[@]}]="200	2		4		2		386		4.5	75	71060"
P[${#P[@]}]="200	2		4		2		441		4.5	75	71070"
P[${#P[@]}]="200	2		4		2		497		4.5	75	71080"
P[${#P[@]}]="200	2		4		2		552		4.5	75	71090"
P[${#P[@]}]="200	2		4		2		648		4.5	75	71190"
P[${#P[@]}]="200	2		4		2		720		4.5	75	71200"
P[${#P[@]}]="200	2		4		1		1152	4.5	75	71100"
P[${#P[@]}]="200	2		4		1		1728	4.5	75	71110"
P[${#P[@]}]="200	2		4		1		2304	4.5	75	71120"
P[${#P[@]}]="200	2		4		1		2880	4.5	75	71130"
P[${#P[@]}]="200	2		4		1		3456	4.5	75	71140"
P[${#P[@]}]="200	2		4		1		4032	4.5	75	71150"
P[${#P[@]}]="200	2		4		1		4608	4.5	75	71160"
P[${#P[@]}]="200	2		4		1		5184	4.5	75	71170"
P[${#P[@]}]="200	2		4		1		5760	4.5	75	71180"
P[${#P[@]}]="200	2		8		2		0		4.5	75	72000"
P[${#P[@]}]="200	2		8		2		111		4.5	75	72010"
P[${#P[@]}]="200	2		8		2		166		4.5	75	72020"
P[${#P[@]}]="200	2		8		2		221		4.5	75	72030"
P[${#P[@]}]="200	2		8		2		276		4.5	75	72040"
P[${#P[@]}]="200	2		8		2		331		4.5	75	72050"
P[${#P[@]}]="200	2		8		2		386		4.5	75	72060"
P[${#P[@]}]="200	2		8		2		441		4.5	75	72070"
P[${#P[@]}]="200	2		8		2		497		4.5	75	72080"
P[${#P[@]}]="200	2		8		2		552		4.5	75	72090"
P[${#P[@]}]="200	2		8		2		648		4.5	75	72190"
P[${#P[@]}]="200	2		8		2		720		4.5	75	72200"
P[${#P[@]}]="200	2		8		1		1152	4.5	75	72100"
P[${#P[@]}]="200	2		8		1		1728	4.5	75	72110"
P[${#P[@]}]="200	2		8		1		2304	4.5	75	72120"
P[${#P[@]}]="200	2		8		1		2880	4.5	75	72130"
P[${#P[@]}]="200	2		8		1		3456	4.5	75	72140"
P[${#P[@]}]="200	2		8		1		4032	4.5	75	72150"
P[${#P[@]}]="200	2		8		1		4608	4.5	75	72160"
P[${#P[@]}]="200	2		8		1		5184	4.5	75	72170"
P[${#P[@]}]="200	2		8		1		5760	4.5	75	72180"
P[${#P[@]}]="200	2		12		2		0		4.5	75	73000"
P[${#P[@]}]="200	2		12		2		111		4.5	75	73010"
P[${#P[@]}]="200	2		12		2		166		4.5	75	73020"
P[${#P[@]}]="200	2		12		2		221		4.5	75	73030"
P[${#P[@]}]="200	2		12		2		276		4.5	75	73040"
P[${#P[@]}]="200	2		12		2		331		4.5	75	73050"
P[${#P[@]}]="200	2		12		2		386		4.5	75	73060"
P[${#P[@]}]="200	2		12		2		441		4.5	75	73070"
P[${#P[@]}]="200	2		12		2		497		4.5	75	73080"
P[${#P[@]}]="200	2		12		2		552		4.5	75	73090"
P[${#P[@]}]="200	2		12		2		648		4.5	75	73190"
P[${#P[@]}]="200	2		12		2		720		4.5	75	73200"
P[${#P[@]}]="200	2		12		1		1152	4.5	75	73100"
P[${#P[@]}]="200	2		12		1		1728	4.5	75	73110"
P[${#P[@]}]="200	2		12		1		2304	4.5	75	73120"
P[${#P[@]}]="200	2		12		1		2880	4.5	75	73130"
P[${#P[@]}]="200	2		12		1		3456	4.5	75	73140"
P[${#P[@]}]="200	2		12		1		4032	4.5	75	73150"
P[${#P[@]}]="200	2		12		1		4608	4.5	75	73160"
P[${#P[@]}]="200	2		12		1		5184	4.5	75	73170"
P[${#P[@]}]="200	2		12		1		5760	4.5	75	73180"
P[${#P[@]}]="200	2		16		2		0		4.5	75	74000"
P[${#P[@]}]="200	2		16		2		111		4.5	75	74010"
P[${#P[@]}]="200	2		16		2		166		4.5	75	74020"
P[${#P[@]}]="200	2		16		2		221		4.5	75	74030"
P[${#P[@]}]="200	2		16		2		276		4.5	75	74040"
P[${#P[@]}]="200	2		16		2		331		4.5	75	74050"
P[${#P[@]}]="200	2		16		2		386		4.5	75	74060"
P[${#P[@]}]="200	2		16		2		441		4.5	75	74070"
P[${#P[@]}]="200	2		16		2		497		4.5	75	74080"
P[${#P[@]}]="200	2		16		2		552		4.5	75	74090"
P[${#P[@]}]="200	2		16		2		648		4.5	75	74190"
P[${#P[@]}]="200	2		16		2		720		4.5	75	74200"
P[${#P[@]}]="200	2		16		1		1152	4.5	75	74100"
P[${#P[@]}]="200	2		16		1		1728	4.5	75	74110"
P[${#P[@]}]="200	2		16		1		2304	4.5	75	74120"
P[${#P[@]}]="200	2		16		1		2880	4.5	75	74130"
P[${#P[@]}]="200	2		16		1		3456	4.5	75	74140"
P[${#P[@]}]="200	2		16		1		4032	4.5	75	74150"
P[${#P[@]}]="200	2		16		1		4608	4.5	75	74160"
P[${#P[@]}]="200	2		16		1		5184	4.5	75	74170"
P[${#P[@]}]="200	2		16		1		5760	4.5	75	74180"
P[${#P[@]}]="200	2		20		2		0		4.5	75	75000"
P[${#P[@]}]="200	2		20		2		111		4.5	75	75010"
P[${#P[@]}]="200	2		20		2		166		4.5	75	75020"
P[${#P[@]}]="200	2		20		2		221		4.5	75	75030"
P[${#P[@]}]="200	2		20		2		276		4.5	75	75040"
P[${#P[@]}]="200	2		20		2		331		4.5	75	75050"
P[${#P[@]}]="200	2		20		2		386		4.5	75	75060"
P[${#P[@]}]="200	2		20		2		441		4.5	75	75070"
P[${#P[@]}]="200	2		20		2		497		4.5	75	75080"
P[${#P[@]}]="200	2		20		2		552		4.5	75	75090"
P[${#P[@]}]="200	2		20		1		1152	4.5	75	75100"
P[${#P[@]}]="200	2		20		1		1728	4.5	75	75110"
P[${#P[@]}]="200	2		20		1		2304	4.5	75	75120"
P[${#P[@]}]="200	2		20		1		2880	4.5	75	75130"
P[${#P[@]}]="200	2		20		1		3456	4.5	75	75140"
P[${#P[@]}]="200	2		20		1		4032	4.5	75	75150"
P[${#P[@]}]="200	2		20		1		4608	4.5	75	75160"
P[${#P[@]}]="200	2		20		1		5184	4.5	75	75170"
P[${#P[@]}]="200	2		20		1		5760	4.5	75	75180"
P[${#P[@]}]="200	2		20		2		648		4.5	75	75190"
P[${#P[@]}]="200	2		20		2		720		4.5	75	75200"
P[${#P[@]}]="200	2		30		2		0		4.5	75	76000"
P[${#P[@]}]="200	2		30		2		111		4.5	75	76010"
P[${#P[@]}]="200	2		30		2		166		4.5	75	76020"
P[${#P[@]}]="200	2		30		2		221		4.5	75	76030"
P[${#P[@]}]="200	2		30		2		276		4.5	75	76040"
P[${#P[@]}]="200	2		30		2		331		4.5	75	76050"
P[${#P[@]}]="200	2		30		2		386		4.5	75	76060"
P[${#P[@]}]="200	2		30		2		441		4.5	75	76070"
P[${#P[@]}]="200	2		30		2		497		4.5	75	76080"
P[${#P[@]}]="200	2		30		2		552		4.5	75	76090"
P[${#P[@]}]="200	2		30		2		648		4.5	75	76190"
P[${#P[@]}]="200	2		30		2		720		4.5	75	76200"
P[${#P[@]}]="200	2		30		1		1152	4.5	75	76100"
P[${#P[@]}]="200	2		30		1		1728	4.5	75	76110"
P[${#P[@]}]="200	2		30		1		2304	4.5	75	76120"
P[${#P[@]}]="200	2		30		1		2880	4.5	75	76130"
P[${#P[@]}]="200	2		30		1		3456	4.5	75	76140"
P[${#P[@]}]="200	2		30		1		4032	4.5	75	76150"
P[${#P[@]}]="200	2		30		1		4608	4.5	75	76160"
P[${#P[@]}]="200	2		30		1		5184	4.5	75	76170"
P[${#P[@]}]="200	2		30		1		5760	4.5	75	76180"

ens='1 2 3 4' # Here, we define a global variable called "ens" which is the total ensemble we use in our simulation.
#ens='1 2' # Here, we define a global variable called "ens" which is the total ensemble we use in our simulation.

for i in ${ens}; do # ${NAME} uses the value saved in variable called NAME; it is like the LAMMPS itself.
	for ((j=0; j<${#P[@]}; j++ )); do
		N=$(echo "${P[$j]}" | awk '{print $1}') # number of monomers
		kBend=$(echo "${P[$j]}" | awk '{print $2}')
		n_hns=$(echo "${P[$j]}" | awk '{print $3}')
		sig4=$(echo "${P[$j]}" | awk '{print $4}') # sizeo of crowders
		n_crowd=$(echo "${P[$j]}" | awk '{print $5}')
		r=$(echo "${P[$j]}" | awk '{print $6}')
		lz=$(echo "${P[$j]}" | awk '{print $7}') # range of x, y or z from -l to l
		randseed_group=$(echo "${P[$j]}" | awk '{print $8}')
		dirname=N${N}kbmm${kBend}r${r}nh${n_hns}ac${sig4}lz${lz}nc${n_crowd}ens${i}.ring
		simname=N${N}kbmm${kBend}r${r}nh${n_hns}ac${sig4}lz${lz}nc${n_crowd}ens${i}
		# minimization and equilibration script
		cp hns-cylindrical-minimize_dna.lmp input.lmp
		echo "variable randseed equal $((i+randseed_group))" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable i equal $i" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable r equal $r" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable lz equal ${lz}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable kBend11 equal ${kBend}" | cat - input.lmp > temp && mv temp input.lmp
		echo '# Defining input parameters:' | cat - input.lmp > temp && mv temp input.lmp
		mv input.lmp minimize_dna.lmp
		[[ -d "${dirname}" ]] || mkdir "${dirname}"
		mv minimize_dna.lmp "${dirname}/"
		cp submit_minimize_dna.sh "${dirname}/" 
		# production script
		if [ $((n_crowd)) -eq 0 ];
		then
			cp hns-cylindrical_v1-ac_equal_a.lmp input.lmp
		else
			if [ $((sig4)) -ne 1 ];
			then
				cp hns-cylindrical_v1.lmp input.lmp	
			else
				cp hns-cylindrical_v1-ac_equal_a.lmp input.lmp
			fi
		fi
		echo "variable simname string ${simname}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable randseed equal $((i+randseed_group))" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable i equal $i" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable r equal $r" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable lz equal ${lz}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable n_crowd equal ${n_crowd}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable sig4 equal ${sig4}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable n_hns equal ${n_hns}" | cat - input.lmp > temp && mv temp input.lmp
		echo "variable kBend11 equal ${kBend}" | cat - input.lmp > temp && mv temp input.lmp
		echo '# Defining input parameters:' | cat - input.lmp > temp && mv temp input.lmp

		mv input.lmp "${dirname}/"
		cp dna.data "${dirname}/"
		cp hns.mol "${dirname}/"

		N_no_crowd=$((N+n_hns))
		if [ $((n_crowd+N_no_crowd)) -ne ${N_no_crowd} ];
		then
			if [ $((n_crowd+N)) -le 5000 ]; 
			then
				cp submit_cpu4_le5000.sh submit.sh && mv submit.sh "$dirname"
			elif [ $((n_crowd+N)) -gt 5000 ] && [ $((n_crowd+N)) -le 15000 ]; then
				cp submit_cpu4_gt5000_le15000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 15000 ] && [ $((n_crowd+N)) -le 30000 ]; then
				cp submit_cpu8_gt15000_le30000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 30000 ] && [ $((n_crowd+N)) -le 75000 ]; then
				cp submit_cpu16_gt30000_le75000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 75000 ] && [ $((n_crowd+N)) -le 150000 ]; then
				cp submit_cpu32_gt75000_le150000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 150000 ] && [ $((n_crowd+N)) -le 200000 ]; then
				cp submit_cpu32_gt150000_le200000.sh submit.sh && mv submit.sh "${dirname}"
			elif [ $((n_crowd+N)) -gt 200000 ] && [ $((n_crowd+N)) -le 250000 ]; then
				cp submit_cpu32_gt150000_le200000.sh submit.sh && mv submit.sh "${dirname}"
			else
				cp submit_cpu32_gt250000_le300000.sh submit.sh && mv submit.sh "${dirname}"
			fi
		else
			cp submit_nocrowd_20hrs.sh submit.sh && mv submit.sh "${dirname}"
		fi
		cd "${dirname}" || exit
		[[ -d restarts ]] || mkdir restarts
		cd ..
	done
done